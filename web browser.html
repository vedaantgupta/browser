
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>Mini Browser App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
/* =========================
   THEME VARIABLES
========================= */
:root {
  --bg: #ffffff;
  --fg: #1a1a1a;
  --accent: #007bff;
  --accent-hover: #0056b3;
  --header-bg: #222;
  --nav-bg: #333;
  --tab-bg: #444;
  --card-bg: #fff;
  --shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
  --radius: 10px;
}

[data-theme="dark"] {
  --bg: #0d1117;
  --fg: #e6edf3;
  --accent: #3399ff;
  --accent-hover: #2277cc;
  --header-bg: #161b22;
  --nav-bg: #21262d;
  --tab-bg: #30363d;
  --card-bg: #1e1e1e;
  --shadow: 0 4px 10px rgba(255, 255, 255, 0.05);
}

/* =========================
   BASE STYLES
========================= */
body {
  margin: 0;
  font-family: 'Segoe UI', Roboto, Arial, sans-serif;
  background: var(--bg);
  color: var(--fg);
  line-height: 1.6;
  text-align: center;
  padding: 20px;
}

h1 {
  font-size: 2rem;
  margin-bottom: 0.5rem;
  color: var(--fg);
}

p {
  font-size: 1.1rem;
  margin-bottom: 2rem;
  color: #555;
}

/* =========================
   HEADER + TOOLS
========================= */
header,
.tools {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  padding: 12px 20px;
  background: var(--header-bg);
  color: white;
  justify-content: flex-start;
}

input[type="text"],
select {
  flex: 1;
  min-width: 220px;
  padding: 10px 14px;
  font-size: 16px;
  border-radius: var(--radius);
  border: none;
  background: #f1f1f1;
  color: var(--fg);
  outline: none;
}

button {
  padding: 10px 16px;
  border: none;
  border-radius: var(--radius);
  background: var(--accent);
  color: white;
  cursor: pointer;
  font-weight: 500;
  transition: background 0.2s;
}

button:hover {
  background: var(--accent-hover);
}

.cta-button {
  background-color: var(--accent);
  color: white;
  padding: 12px 22px;
  border-radius: var(--radius);
  font-size: 15px;
  text-decoration: none;
  transition: background 0.3s;
}

.cta-button:hover {
  background-color: var(--accent-hover);
}

/* =========================
   NAVIGATION (TABS)
========================= */
nav {
  background: var(--nav-bg);
  display: flex;
  gap: 8px;
  padding: 10px 20px;
  overflow-x: auto;
}

nav button.tab {
  background: var(--tab-bg);
  color: white;
  padding: 8px 16px;
  border-radius: var(--radius);
  white-space: nowrap;
}

nav button.tab.active {
  background: var(--accent);
}

/* =========================
   IFRAME + PROGRESS
========================= */
iframe {
  width: 100%;
  height: calc(100vh - 200px);
  border: none;
  background: var(--card-bg);
}

#progressBar {
  height: 4px;
  background: var(--accent);
  width: 0%;
  transition: width 0.3s;
}

/* =========================
   SECTIONS + CARDS
========================= */
.section {
  background: var(--card-bg);
  padding: 24px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  margin: 20px auto;
  max-width: 1000px;
  text-align: left;
}

.section h2 {
  font-size: 24px;
  margin-bottom: 16px;
  color: var(--fg);
}

.result a {
  font-size: 18px;
  font-weight: bold;
  color: var(--accent);
  text-decoration: none;
}

.result a:hover {
  text-decoration: underline;
}

.result p {
  font-size: 14px;
  margin: 6px 0 14px;
  color: var(--fg);
}

/* =========================
   GRID LAYOUT (AI Hub)
========================= */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 25px;
  justify-content: center;
  margin: 0 auto;
  max-width: 1000px;
}

.grid a {
  text-decoration: none;
  color: #333;
  background: #fff;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: all 0.3s;
}

.grid a:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
}

.grid img {
  width: 50px;
  height: 50px;
  object-fit: contain;
  margin-bottom: 8px;
}

.grid span {
  font-size: 0.9rem;
  font-weight: 600;
}

/* =========================
   APP CARDS (Enhanced Links)
========================= */
.app-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.app-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-decoration: none;
  background: #fff;
  padding: 15px;
  border-radius: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  transition: transform 0.3s, box-shadow 0.3s;
}

.app-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
}

.app-card img {
  width: 50px;
  height: 50px;
  object-fit: contain;
  margin-bottom: 8px;
}

.app-card span {
  font-size: 0.9rem;
  font-weight: 600;
  color: #333;
}

/* =========================
   IMAGE GALLERY + MODAL
========================= */
#gallery {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: flex-start;
  margin-top: 20px;
}

#gallery div {
  background: var(--card-bg);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 10px;
  max-width: 300px;
  flex: 1 1 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s;
}

#gallery div:hover {
  transform: translateY(-4px);
}

#gallery img {
  max-width: 100%;
  max-height: 250px;
  object-fit: contain;
  display: block;
  border-radius: 6px;
  cursor: pointer;
}

.modal {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.8);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  flex-direction: column;
}

.modal img {
  max-width: 90vw;
  max-height: 85vh;
  object-fit: contain;
  border-radius: var(--radius);
  transition: transform 0.3s;
}

.zoom-controls {
  margin-top: 16px;
  display: flex;
  gap: 12px;
}

.zoom-controls button {
  padding: 10px 16px;
  background: #fff;
  color: #333;
  border-radius: 6px;
  font-size: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  border: none;
  cursor: pointer;
  transition: background 0.2s;
}

.zoom-controls button:hover {
  background: #f0f0f0;
}

/* =========================
   HISTORY BOX
========================= */
aside#historyBox {
  display: none;
  background: var(--card-bg);
  color: var(--fg);
  padding: 20px;
}

aside#historyBox ul {
  list-style: none;
  padding: 0;
  margin: 0;
  text-align: left;
}

/* =========================
   NAVBAR (Top Menu)
========================= */
.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #2c3e50;
  padding: 12px 24px;
  color: #fff;
  position: sticky;
  top: 0;
  z-index: 100;
}

.navbar .logo {
  font-size: 1.5rem;
  font-weight: bold;
  letter-spacing: 1px;
  color: #fff;
  text-decoration: none;
}

.navbar ul {
  list-style: none;
  display: flex;
  gap: 20px;
  margin: 0;
  padding: 0;
}

.navbar ul li a {
  color: #fff;
  text-decoration: none;
  padding: 8px 12px;
  border-radius: 6px;
  transition: background 0.3s;
}

.navbar ul li a:hover {
  background: #3498db;
}

.navbar .btn {
  background: #e67e22;
  padding: 8px 16px;
  border-radius: 6px;
  color: #fff;
  text-decoration: none;
  transition: background 0.3s;
}

.navbar .btn:hover {
  background: #d35400;
}

@media (max-width:768px) {
  .navbar { flex-direction: column; align-items: flex-start; }
  .navbar ul { flex-direction: column; width: 100%; }
  .navbar ul li { width: 100%; }
  .navbar ul li a { display: block; width: 100%; }
}

/* ==============================
   ADVANCED AI HUB (scoped to #ai)
   Paste this at the END of your <style> so it overrides earlier .section rules
   ============================== */
section#ai.section {
  background: linear-gradient(180deg,#071022 0%, #0f172a 100%);
  color: #e6f7ff;
  padding: 48px 28px;
  border-radius: 16px;
  max-width: 1200px;
  margin: 48px auto;
  box-shadow: 0 12px 40px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
  text-align: center;
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
  -webkit-font-smoothing:antialiased;
}

/* Heading + subtitle */
section#ai.section h1 {
  font-size: 2.5rem;
  margin: 0 0 6px;
  color: #38bdf8; /* vibrant sky blue */
  text-shadow: 0 4px 15px rgb(163, 227, 255);
  line-height: 1.05;
}
section#ai.section p {
  margin: 0 0 20px;
  color: #94a3b8; /* subtle cool gray */
  font-size: 1.05rem;
}

/* Grid of cards */
section#ai.section .grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 20px;
  max-width: 1100px;
  margin: 20px auto 0;
  padding: 0 6px;
}

/* Individual card */
section#ai.section .grid a {
  background: rgba(255,255,255,0.03);
  border-radius: 12px;
  padding: 16px;
  color: inherit;
  text-decoration: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: transform 0.25s cubic-bezier(.2,.9,.2,1), box-shadow 0.25s, background 0.25s;
  box-shadow: 0 6px 18px rgba(2,6,23,0.45);
  min-height: 96px;
}

/* Hover state */
section#ai.section .grid a:hover {
  transform: translateY(-8px);
  box-shadow: 0 18px 40px rgba(56,189,248,0.12);
  background: rgba(56,189,248,0.03);
}

/* Logo inside card */
section#ai.section .grid a img {
  width: 56px;
  height: 56px;
  object-fit: contain;
  border-radius: 10px;
  background: rgba(255,255,255,0.03);
  padding: 8px;
  transition: transform 0.18s;
}

/* Logo zoom on hover */
section#ai.section .grid a:hover img {
  transform: scale(1.08);
}

/* Platform name */
section#ai.section .grid span {
  margin-top: 8px;
  font-weight: 600;
  color: #e6f7ff;
  font-size: 0.98rem;
  letter-spacing: 0.2px;
}

/* Small screens */
@media (max-width: 720px) {
  section#ai.section {
    padding: 28px 16px;
    margin: 28px 12px;
  }
  section#ai.section h1 { font-size: 1.8rem; }
  section#ai.section .grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px; }
  section#ai.section .grid a { padding: 12px; min-height: 85px; }
  section#ai.section .grid a img { width: 50px; height: 50px; padding: 6px; }
}

/* Heading */
section#ai.section h1 {
  font-size: 2.5rem;
  margin: 0 0 1.25rem; /* increased gap to ~4 units */
  color: #38bdf8;
  text-shadow: 0 4px 30px rgba(56,189,248,0.15);
  line-height: 1.05;
}

/* Subtitle */
section#ai.section p {
  margin: 0 0 2rem; /* increased gap to ~5 units before the grid */
  color: #94a3b8;
  font-size: 1.05rem;
}

.black-button {
  background-color: #000000; /* Pure black */
  color: #ffffff; /* White text for contrast */
  border: none; /* Remove default border if desired */
  padding: 10px 20px; /* Adjust padding as needed */
  font-size: 16px; /* Adjust font size as needed */
  cursor: pointer; /* Indicate it's clickable */
}
  </style>
</head>
<body>
 <header>
    <button onclick="goBack()">⬅️</button>
    <button onclick="goForward()">➡️</button>
    <input type="text" id="urlInput" placeholder="Enter URL">
    <button onclick="startListening('url')">🎤</button>
    <button onclick="navigate()">Go</button>
    <button onclick="addBookmark()">🔖</button>
    <button onclick="toggleTheme()">🌓</button>
    <button onclick="toggleIncognito()">🕵️</button>
    <select id="profileSelect" onchange="switchProfile(this.value)">
      <option value="default">Default</option>
      <option value="work">Work</option>
      <option value="personal">Personal</option>
    </select>
  </header>

  <nav id="tabs"></nav>

  <div class="tools">
    <span>Bookmarks:</span>
    <select id="bookmarkList" onchange="loadBookmark(this.value)">
      <option disabled selected>Select</option>
    </select>
    <button onclick="addTab()">➕ Tab</button>
    <button onclick="removeTab()">❌ Tab</button>
    <a href="bot.html" class="cta-button" target="_blank">AssistAI</a>
    <a href="how to use guide.html" class="cta-button" target="_blank">How to Use</a>
    <button onclick="showHistory()">📜 <small style="color:#ccc;">history</small></button>
  </div>

  <div class="tools">
    <input type="text" id="searchBox" placeholder="Search Topic...">
    <button onclick="startListening('search')">🎤</button>
    <button onclick="runSearch()">Search</button>
    <button class="black-button" onclick="openGoogleLens()" title="Google Lens"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Logo_of_Google_Lens.svg/2560px-Logo_of_Google_Lens.svg.png" width="100"></button>
<button onclick="openBingLens()" title="Bing Lens">🧿 Bing Lens</button>
  </div>

  <div id="progressBar"></div>

  <main id="output">

    <section id="aiSummary" style="margin-top: 40px;">
  <div style="display: flex; flex-wrap: wrap; gap: 20px;">
    
    <!-- Text Content -->
    <div style="flex: 1 1 60%; min-width: 320px; background: #fff; padding: 20px 25px; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.1);">
      <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
        <h2 style="font-size: 24px; margin: 0;">🧠 AI Summary</h2>
        <div style="display: flex; gap: 10px; align-items: center;">
          <select id="summaryMode" onchange="renderAISummary()" style="padding: 4px 8px;">
            <option value="paragraph">📝 Paragraph</option>
            <option value="short">🔹 Short Points</option>
            <option value="long">🔸 Long Points</option>
            <option value="chart">📊 Table</option>
          </select>
          <select id="summaryLang" onchange="renderAISummary()" style="padding: 4px 8px;">
            <option value="en">English</option>
            <option value="hi">हिंदी</option>
          </select>
          <button onclick="speakSummary()" style="padding: 4px 10px; background: #007BFF; color: white; border: none; border-radius: 6px;">🔊 Hear</button>
        </div>
      </div>
      <hr style="margin: 12px 0;">
      <div id="aiSummaryContent" style="font-size: 16px; line-height: 1.6;">⏳ Loading summary...</div>
    </div>

    <!-- Image Box -->
    <div id="aiImageBox" style="flex: 1 1 30%; min-width: 250px; max-width: 400px; text-align: center;">
      <img id="aiTopicImage" src="" alt="Topic Image" style="max-width: 100%; border-radius: 12px; box-shadow: 0 8px 16px rgba(0,0,0,0.15);">
    </div>
    
  </div>
</section>

    <section id="wiki" class="section">

<!-- Wikipedia Results Area -->
<div id="wikiSection">
 <div id="listenControls" style="display: none; margin-bottom: 15px; padding: 10px; background: #f0f0f0; border-radius: 10px;">
  <label for="languageSelect"><strong>Voice Language:</strong></label>
  <select id="languageSelect" style="margin: 0 10px;"></select>
  <div style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;">
    <button onclick="speakWikipediaSummary()">🔊 Listen</button>
    <button onclick="pauseSpeaking()">⏸ Pause</button>
    <button onclick="resumeSpeaking()">▶️ Resume</button>
    <button onclick="stopSpeaking()">⏹ Stop</button>
  </div>
</div>


  <div id="wikiContent">
    <!-- Wikipedia summary gets injected here -->
  </div>
</div>

    </section>
    
        <section id="images" class="section">
      <h2>📸 Images</h2>

<div id="gallery" class="gallery"></div>

<div id="imgModal" class="modal" onclick="closeModal(event)">
  <img id="modalImg" src="" alt="Preview">
  <div class="zoom-controls">
    <button onclick="zoomIn()">➕ Zoom</button>
    <button onclick="zoomOut()">➖ Zoom</button>
  </div>
</div>
    </section>
    
    <section id="results" class="section"></section>

<section id="ai" class="section">
        <h1>⚡ Advanced AI Hub</h1>
  <p>Quick access to the best AI platforms</p>

  <div class="grid">
    <!-- ChatGPT -->
    <a href="https://chatgpt.com/" target="_blank">
      <img src="https://chatgpt.com/favicon.ico" alt="ChatGPT">
      <span>ChatGPT</span>
    </a>

    <!-- Google -->
    <a href="https://www.google.com/" target="_blank">
      <img src="https://www.google.com/favicon.ico" alt="Google">
      <span>Google</span>
    </a>

    <!-- Google AI -->
    <a href="https://ai.google/" target="_blank">
      <img src="https://www.logoshape.com/wp-content/uploads/2025/03/Google_Ai_vector_Logo.png" alt="Google AI">
      <span>Google AI</span>
    </a>

    <!-- Gemini -->
    <a href="https://gemini.google.com/" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Google_Gemini_logo.svg/344px-Google_Gemini_logo.svg.png" alt="Gemini">
      <span>Gemini</span>
    </a>

    <!-- Microsoft Copilot -->
    <a href="https://copilot.microsoft.com/" target="_blank">
      <img src="https://copilot.microsoft.com/favicon.ico" alt="Copilot">
      <span>Copilot</span>
    </a>

    <!-- Meta AI -->
    <a href="https://www.meta.ai/" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/3/3b/Meta_AI_Logo_%28Ring_Only%29.png" alt="Meta AI">
      <span>Meta AI</span>
    </a>

    <!-- Canva -->
    <a href="https://www.canva.com/ai/" target="_blank">
      <img src="https://www.canva.com/favicon.ico" alt="Canva">
      <span>Canva</span>
    </a>

    <!-- VS Code -->
    <a href="https://code.visualstudio.com/" target="_blank">
      <img src="https://code.visualstudio.com/favicon.ico" alt="VS Code">
      <span>VS Code</span>
    </a>

    <!-- OpenAI -->
    <a href="https://openai.com/" target="_blank">
      <img src="https://openai.com/favicon.ico" alt="OpenAI">
      <span>OpenAI</span>
    </a>

    <!-- Microsoft -->
    <a href="https://www.microsoft.com/" target="_blank">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR8u8BZcgcIxcfgSJsas_HDf2pfYTBlmo2q3g&s" alt="Microsoft">
      <span>Microsoft</span>
    </a>

    <!-- Alexa -->
    <a href="https://alexa.amazon.com/" target="_blank">
      <img src="https://www.amazon.com/favicon.ico" alt="Alexa">
      <span>Alexa</span>
    </a>
  </div>
</section>
  
  </main>

  <!-- Site Header -->
  <header role="banner">
 
  </header>

  <aside id="historyBox">
    <button onclick="closeHistory()" style="float:right; background:red; color:white; border:none;">X</button>
    <h3>🕘 Browsing History</h3>
    <ul id="historyList"></ul>
  </aside>

<script>
const viewer = document.getElementById("viewer");
const urlInput = document.getElementById("urlInput");
const searchBox = document.getElementById("searchBox");
const bookmarkList = document.getElementById("bookmarkList");

let tabs = [{ url: "about:blank" }];
let activeTab = 0;
let historyStack = [];
let currentIndex = -1;
let bookmarks = [];
let incognito = false;
let currentProfile = "default";
let availableVoices = [];
let currentUtterance = null;
let currentZoom = 1;

const preferredLanguages = [
  { code: "en-US", name: "English" },
  { code: "es-ES", name: "Spanish" },
  { code: "hi-IN", name: "Hindi" },
  { code: "zh-CN", name: "Chinese" },
  { code: "fr-FR", name: "French" },
  { code: "ar-SA", name: "Arabic" },
  { code: "pt-BR", name: "Portuguese" },
  { code: "ru-RU", name: "Russian" },
  { code: "bn-IN", name: "Bengali" },
  { code: "de-DE", name: "German" }
];

window.onload = () => {
  loadBookmarks();
  renderBookmarks();
  availableVoices = speechSynthesis.getVoices();
  populateLanguageSelect();
  speechSynthesis.onvoiceschanged = () => {
    availableVoices = speechSynthesis.getVoices();
    populateLanguageSelect();
  };
};

function sanitizeURL(input) {
  try {
    let url = input.trim();
    if (!url) return "";
    if (!url.includes(".") && !url.startsWith("http")) {
      return `https://lite.duckduckgo.com/lite/?q=${encodeURIComponent(url)}`;
    }
    if (!url.startsWith("http")) {
      url = "https://" + url;
    }
    return new URL(url).href;
  } catch {
    alert("Invalid URL");
    return "";
  }
}

function navigate() {
  const url = sanitizeURL(urlInput.value);
  if (url) {
    window.open(url, "_blank");
    if (!incognito) updateHistory(url);
  }
}

function goBack() {
  if (currentIndex > 0) {
    currentIndex--;
    window.open(historyStack[currentIndex], "_blank");
  }
}

function goForward() {
  if (currentIndex < historyStack.length - 1) {
    currentIndex++;
    window.open(historyStack[currentIndex], "_blank");
  }
}

function updateHistory(url) {
  if (currentIndex < historyStack.length - 1) {
    historyStack.splice(currentIndex + 1);
  }
  historyStack.push(url);
  currentIndex = historyStack.length - 1;
  saveToLocalHistory(url);
}

function saveToLocalHistory(url) {
  const now = new Date().toLocaleString();
  const history = JSON.parse(localStorage.getItem("history") || "[]");
  history.push({ url, time: now });
  localStorage.setItem("history", JSON.stringify(history));
}

function showHistory() {
  const box = document.getElementById("historyBox");
  const list = document.getElementById("historyList");
  list.innerHTML = "";

  const historyItems = JSON.parse(localStorage.getItem("history") || "[]");

  historyItems.slice(-100).reverse().forEach((entry, index) => {
    const itemId = historyItems.length - 1 - index; // correct index for delete

    const li = document.createElement("li");
    li.style.display = "flex";
    li.style.justifyContent = "space-between";
    li.style.alignItems = "center";
    li.style.padding = "4px 0";

    const leftContent = document.createElement("div");
    leftContent.innerHTML = `
      <small>${entry.time}</small><br>
      <a href="#" onclick="searchFromHistory('${entry.url.replace(/'/g, "\\'")}')">${entry.url}</a>
    `;

    const deleteIcon = document.createElement("span");
    deleteIcon.innerHTML = "🗑️";
    deleteIcon.style.cursor = "pointer";
    deleteIcon.title = "Delete";
    deleteIcon.onclick = () => deleteHistoryItem(itemId);

    li.appendChild(leftContent);
    li.appendChild(deleteIcon);
    list.appendChild(li);
  });

  box.style.display = "block";
}

function deleteHistoryItem(index) {
  let history = JSON.parse(localStorage.getItem("history") || "[]");
  history.splice(index, 1);
  localStorage.setItem("history", JSON.stringify(history));
  showHistory(); // Refresh UI
}

function searchFromHistory(query) {
  searchBox.value = query;
  runSearch();
  closeHistory();
}

function closeHistory() {
  document.getElementById("historyBox").style.display = "none";
}

function loadFromHistory(url) {
  window.open(url, "_blank");
  closeHistory();
}

function addBookmark() {
  const url = sanitizeURL(urlInput.value);
  if (!incognito && url && !bookmarks.includes(url)) {
    bookmarks.push(url);
    saveBookmarks();
    renderBookmarks();
  }
}

function renderBookmarks() {
  bookmarkList.innerHTML = '<option disabled selected>Select</option>';
  bookmarks.forEach(url => {
    const opt = document.createElement("option");
    opt.value = url;
    opt.textContent = url;
    bookmarkList.appendChild(opt);
  });
}

function loadBookmarks() {
  try {
    bookmarks = JSON.parse(localStorage.getItem(`bookmarks_${currentProfile}`)) || [];
  } catch {
    bookmarks = [];
  }
  renderBookmarks();
}

function saveBookmarks() {
  localStorage.setItem(`bookmarks_${currentProfile}`, JSON.stringify(bookmarks));
}

function loadBookmark(url) {
  if (url) window.open(url, "_blank");
}

function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute("data-theme");
  html.setAttribute("data-theme", current === "light" ? "dark" : "light");
}

function toggleIncognito() {
  incognito = !incognito;
  alert(`Incognito ${incognito ? "ON" : "OFF"}`);
}

function switchProfile(profile) {
  currentProfile = profile;
  loadBookmarks();
}

function startListening(target = "search") {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-IN";
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    if (target === "search") {
      searchBox.value = transcript;
      runSearch();
    } else {
      urlInput.value = transcript;
      navigate();
    }
  };

  recognition.onerror = (event) => alert("Voice input error: " + event.error);
  recognition.onspeechend = () => recognition.stop();
  recognition.start();
}

function runSearch() {
  const query = searchBox.value.trim();
  if (!query) return;
  document.getElementById("wikiContent").innerHTML = `<p>Loading summary...</p>`;
  document.getElementById("listenControls").style.display = "none";
  fetchWikipedia(query);
  showEnhancedLinks(query);
  searchImages(query);
  if (!incognito) saveToLocalHistory(query);
  generateAISummary(query);
}

function fetchWikipedia(query) {
  fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`)
    .then(res => res.json())
    .then(data => {
      if (data.type?.includes("not_found")) {
        document.getElementById("wikiContent").innerHTML = `<p>No Wikipedia article found for "${query}".</p>`;
        return;
      }

      const highlighted = data.extract
        .split(/(?<=\.|!|\?)\s+/)
        .map(sentence => highlightImportantWords(sentence))
        .map(sentence => `<span style="background-color: #ffff99;">${sentence}</span>`)
        .join(" ");

      const imgTag = data.thumbnail ? `<a href="${data.thumbnail.source}" target="_blank"><img src="${data.thumbnail.source}" alt="${query}" style="max-width:200px;"></a>` : "";
      document.getElementById("wikiContent").innerHTML = `
        <h2>Wikipedia Summary</h2>
        <p id="wikiSummaryText">${highlighted}</p>
        ${imgTag}
        <p><a href="${data.content_urls.desktop.page}" target="_blank">Read full article</a></p>`;
      document.getElementById("listenControls").style.display = "block";
    })
    .catch(() => {
      document.getElementById("wikiContent").innerHTML = `<p>Failed to load Wikipedia summary.</p>`;
    });
}

function highlightImportantWords(sentence) {
  return sentence.replace(/\b([A-Z][a-z]{2,}|\d{4}|AI|ML|NASA|UN|USA|India|World|Technology)\b/g, '<b><i>$1</i></b>');
}

function populateLanguageSelect() {
  const select = document.getElementById("languageSelect");
  select.innerHTML = "";
  preferredLanguages.forEach(lang => {
    const opt = document.createElement("option");
    opt.value = lang.code;
    opt.textContent = lang.name;
    select.appendChild(opt);
  });
}

function speakWikipediaSummary() {
  const text = document.getElementById("wikiSummaryText")?.innerText;
  if (!text) return alert("No summary available to read.");
  const lang = document.getElementById("languageSelect").value;
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = lang;
  const voice = availableVoices.find(v => v.lang === lang && v.name.includes("Google")) ||
                availableVoices.find(v => v.lang === lang) ||
                availableVoices.find(v => v.lang.startsWith(lang.split('-')[0]));
  if (voice) {
    utterance.voice = voice;
    speechSynthesis.cancel();
    currentUtterance = utterance;
    speechSynthesis.speak(utterance);
  } else {
    alert("Voice not available.");
  }
}

function pauseSpeaking() {
  if (speechSynthesis.speaking && !speechSynthesis.paused) speechSynthesis.pause();
}

function resumeSpeaking() {
  if (speechSynthesis.paused) speechSynthesis.resume();
}

function stopSpeaking() {
  speechSynthesis.cancel();
}

function showEnhancedLinks(query) {
  const encoded = encodeURIComponent(query);
  const links = [
    { name: "DuckDuckGo", url: `https://lite.duckduckgo.com/lite/?q=${encoded}`, icon: "https://upload.wikimedia.org/wikipedia/en/thumb/9/90/The_DuckDuckGo_Duck.png/960px-The_DuckDuckGo_Duck.png?20211207123706" },
    { name: "Wikipedia", url: `https://en.wikipedia.org/wiki/${encoded}`, icon: "https://en.wikipedia.org/favicon.ico" },
    { name: "GitHub", url: `https://github.com/search?q=${encoded}`, icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Octicons-mark-github.svg/960px-Octicons-mark-github.svg.png" },
    { name: "YouTube", url: `https://www.youtube.com/results?search_query=${encoded}`, icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/YouTube_full-color_icon_%282017%29.svg/2560px-YouTube_full-color_icon_%282017%29.svg.png" },
    { name: "Amazon", url: `https://www.amazon.in/s?k=${encoded}`, icon: "https://www.amazon.in/favicon.ico" },
    { name: "Flipkart", url: `https://www.flipkart.com/search?q=${encoded}`, icon: "https://logos-world.net/wp-content/uploads/2020/11/Flipkart-Emblem.png" },
    { name: "Pinterest", url: `https://www.pinterest.com/search/pins/?q=${encoded}`, icon: "https://upload.wikimedia.org/wikipedia/commons/0/08/Pinterest-logo.png" },
    { name: "Google Play", url: `https://play.google.com/store/search?q=${encoded}&c=apps`, icon: "https://play.google.com/favicon.ico" },

    // ✅ Indian News Channels
    { name: "Aaj Tak", url: `https://www.aajtak.in/search?q=${encoded}`, icon: "https://upload.wikimedia.org/wikipedia/commons/2/28/Aaj_tak_logo.png" },
    { name: "India Today TV", url: `https://www.indiatoday.in/search/site/${encoded}`, icon: "https://upload.wikimedia.org/wikipedia/commons/b/be/India_Today_TV_Channel_logo.jpg" },
    { name: "NDTV News", url: `https://www.ndtv.com/search?searchtext=${encoded}`, icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/NDTV_logo.svg/313px-NDTV_logo.svg.png" },
    { name: "Zee News", url: `https://zeenews.india.com/searchresults?q=${encoded}`, icon: "https://zeenews.india.com/favicon.ico" },
    { name: "ABP News", url: `https://www.abplive.com/search/${encoded}`, icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/48/ABP_News_logo.svg/250px-ABP_News_logo.svg.png" }
  ];

  document.getElementById("results").innerHTML = `
    <h2>Relevant Apps for "${query}"</h2>
    <div class="app-grid">
      ${links.map(link => `
        <a href="${link.url}" class="app-card" target="_blank">
          <img src="${link.icon}" alt="${link.name} logo">
          <span>${link.name}</span>
        </a>
      `).join("")}
    </div>`;
}



function searchImages(topic) {
  if (!topic) return;
  const encoded = encodeURIComponent(topic);
  const container = document.getElementById("gallery");
  container.innerHTML = "";

  const urls = new Set();
  for (let i = 0; i < 60; i++) {
    urls.add(`https://tse${(i % 5) + 1}.mm.bing.net/th?q=${encoded}+bing+${i}`);
    urls.add(`https://tse${(i % 4) + 1}.mm.bing.net/th?q=${encoded}+pinterest+${i}`);
  }

  const imageHashes = [];
  const maxImages = 20;
  let added = 0;

  Array.from(urls).forEach((src) => {
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.src = src;

    img.onload = () => {
      try {
        const hash = getAverageHash(img);
        if (!isSimilarHash(hash, imageHashes) && added < maxImages) {
          imageHashes.push(hash);
          const clone = img.cloneNode();
          clone.onclick = () => openModal(src);
          container.appendChild(clone);
          added++;
        }
      } catch {}
    };
  });

  function getAverageHash(image) {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    const size = 8;
    canvas.width = size;
    canvas.height = size;
    ctx.drawImage(image, 0, 0, size, size);
    const data = ctx.getImageData(0, 0, size, size).data;

    const grayscale = [];
    for (let i = 0; i < data.length; i += 4) {
      const r = data[i], g = data[i + 1], b = data[i + 2];
      grayscale.push(0.299 * r + 0.587 * g + 0.114 * b);
    }

    const avg = grayscale.reduce((sum, val) => sum + val, 0) / grayscale.length;
    return grayscale.map(val => (val > avg ? 1 : 0)).join('');
  }

  function hammingDistance(hash1, hash2) {
    return hash1.split('').filter((char, i) => char !== hash2[i]).length;
  }

  function isSimilarHash(newHash, existingHashes) {
    const threshold = 5;
    return existingHashes.some(h => hammingDistance(newHash, h) <= threshold);
  }
}

function openModal(src) {
  currentZoom = 1;
  const modal = document.getElementById("imgModal");
  const modalImg = document.getElementById("modalImg");
  modalImg.src = src;
  modalImg.style.transform = `scale(${currentZoom})`;
  modal.style.display = "flex";
}

function closeModal(e) {
  if (e.target.id === "imgModal" || e.target.tagName === "IMG") {
    document.getElementById("imgModal").style.display = "none";
  }
}

function zoomIn() {
  currentZoom += 0.1;
  document.getElementById("modalImg").style.transform = `scale(${currentZoom})`;
}

function zoomOut() {
  currentZoom = Math.max(0.1, currentZoom - 0.1);
  document.getElementById("modalImg").style.transform = `scale(${currentZoom})`;
}

urlInput.addEventListener("keypress", e => { if (e.key === "Enter") navigate(); });
searchBox.addEventListener("keypress", e => { if (e.key === "Enter") runSearch(); });

let combinedFacts = [];
const minFacts = 10;

async function generateAISummary(topic) {
  document.getElementById("aiSummaryContent").innerHTML = "⏳ Loading summary...";
  combinedFacts = [];

  // Wikipedia API
  const wiki = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(topic)}`).then(r => r.json()).catch(() => null);
  if (wiki?.extract) extractUniqueFacts(wiki.extract);

  // DuckDuckGo API
  const ddg = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(topic)}&format=json&no_html=1`).then(r => r.json()).catch(() => null);
  if (ddg?.AbstractText) extractUniqueFacts(ddg.AbstractText);

  // Static fallback or boost
  if (topic.toLowerCase() === "ms dhoni") {
    extractUniqueFacts("Born on 7 July 1981 in Ranchi. He debuted for Bihar in 1999. Captain of India in 3 ICC victories. Winner of Padma Bhushan, Padma Shri, and Khel Ratna.");
  }

  while (combinedFacts.length < minFacts) {
    combinedFacts.push("No further factual data available at this time.");
  }

  renderAISummary();
  renderAIImage(topic);
}

function extractUniqueFacts(text) {
  const sentences = text.split(/(?<=\.|\?|!)\s+/);
  for (let s of sentences) {
    const trimmed = s.trim();
    if (trimmed.length > 30 && !combinedFacts.some(f => f.includes(trimmed) || trimmed.includes(f))) {
      combinedFacts.push(trimmed);
    }
  }
}

function highlightKeywords(text, lang) {
  const keywords = lang === "hi"
    ? ["कप्तान", "पद्म", "जीत", "खिलाड़ी", "उपलब्धि"]
    : ["captain", "award", "winner", "leader", "debut", "record", "trophy", "born"];
  const strongWords = [...new Set(keywords)];
  const regex = new RegExp(`\\b(${strongWords.join('|')})\\b`, 'gi');
  return text.replace(regex, '<strong style="color:#007BFF;">$1</strong>');
}

function translateToHindi(text) {
  // Simplified manual translation fallback (demo only)
  return text
    .replace(/India/g, "भारत")
    .replace(/captain/g, "कप्तान")
    .replace(/born/g, "जन्म")
    .replace(/won/g, "जीत")
    .replace(/debut/g, "पदार्पण")
    .replace(/trophy/g, "ट्रॉफी")
    .replace(/record/g, "रिकॉर्ड")
    .replace(/award/g, "पुरस्कार")
    .replace(/player/g, "खिलाड़ी");
}

function renderAISummary() {
  const mode = document.getElementById("summaryMode").value;
  const lang = document.getElementById("summaryLang").value;
  const content = document.getElementById("aiSummaryContent");

  let facts = [...combinedFacts];
  if (lang === "hi") {
    facts = facts.map(f => highlightKeywords(translateToHindi(f), lang));
  } else {
    facts = facts.map(f => highlightKeywords(f, lang));
  }

  if (mode === "paragraph") {
    content.innerHTML = `<p>${facts.join(" ")}</p>`;
  } else if (mode === "short") {
    content.innerHTML = `<ul>${facts.slice(0, 5).map(f => `<li>${f}</li>`).join("")}</ul>`;
  } else if (mode === "long") {
    content.innerHTML = `<ul>${facts.map(f => `<li>${f}</li>`).join("")}</ul>`;
  } else if (mode === "chart") {
    content.innerHTML = `
      <table style="width:100%; border-collapse: collapse;">
        ${facts.map(f => {
          const parts = f.split(/[:\-–]/, 2);
          if (!parts[1]) return '';
          return `<tr><td style="padding:8px;border:1px solid #ddd;"><strong>${parts[0]}</strong></td>
                  <td style="padding:8px;border:1px solid #ddd;">${parts[1]}</td></tr>`;
        }).join("")}
      </table>`;
  }
}

function speakSummary() {
  const lang = document.getElementById("summaryLang").value;
  const facts = [...combinedFacts];
  const speechText = facts.join(" ");
  const utterance = new SpeechSynthesisUtterance(speechText);
  utterance.lang = lang === "hi" ? "hi-IN" : "en-US";
  speechSynthesis.cancel();
  speechSynthesis.speak(utterance);
}

function renderAIImage(topic) {
  const image = document.getElementById("aiTopicImage");
  const url = `https://tse1.mm.bing.net/th?q=${encodeURIComponent(topic)} site:pinterest.com&pid=ImgRaw&r=0`;
  image.src = url;
  image.alt = topic;
}

function openGoogleLens() {
  window.open("https://lens.google.com/", "_blank");
}

function openBingLens() {
  window.open("https://www.bing.com/visualsearch", "_blank");
}

</script>

</body>
</html>
